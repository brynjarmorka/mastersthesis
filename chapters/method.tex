\chapter{Method}
\label{ch:method}

Intro to the method \dots

% from masteravtalen:
% •	Characterize detector and beam parameters and use them for better quantification.
% •	Develop detector characterization and quantification routines for bulk samples in open-source.


\section{Qualitative analysis}
\label{method:qualitative_analysis}

See Annex A in ISO 22309. Also make a notebook, which can be shared with HyperSpy people.
Show the use of find_peak_ohaver, refering to O'Haver's paper, with different settings.
Also show nice plotly plots, eventually plt with plotting all lines in HS for the element.
And maybe also fitting, where the area is shown to see if any added elements are 0.
Can refer to autoID, and it's flaws.

Rule for what a peak is? See eg Annex A in ISO 22309: I > (BG + 3 x sqrt(BG)), wher BG is mean of BG (probably at the given energy)

\brynjar{ISO 22309: "typically a value of 30 eV can
    be critical; peaks separated by more than this figure should not be confused by either automatic or manual
    identification procedures."}

\section{Detector status}
\label{method:detector_status}

Intro to detector characterization \dots

\subsection{Jupyter notebook input}
\label{method:detector_status:input}

The QC notebook was written in Python 3.7 using the Jupyter notebook environment.
The notebook was designed to be adaptable to spectra with different elements.
At the top of the notebook the user give the spectrum file, the detector parameters, the elements in the sample, and the elemental lines of interest.

In this project, the QC notebook was used on three different samples: \brynjar{NiO, Cu, GaAs?}




% \subsection{Calibration}
% \label{method:calibration}

% For some reason, it works better to calibrate the offset and then the scale/dispersion.
% HyperSpy allows for calibration of offset, scale or energy resolution, but only one at a time.
% The procedure used was: calibrate offset, calibrate scale, recaliabrate offset, and recalibrate scale.
% After the recalibration, the difference was compared to the first calibration, and if the change was more than 5\%, the calibration was repeated.
% By default, the HyperSpy calibration uses all alpha lines.
% It is possible to specify certain lines to calibrate on, but this yeilded the same or worse results as using all alpha lines.
% \brynjar{The stuff above is more discussion, at least the last sentence.}
